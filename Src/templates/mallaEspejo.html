<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Malla Espejo</title>
  <link rel="stylesheet" href="../static/css/malla_espejo.css">
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/sweetalert2@11/dist/sweetalert2.min.css">
  <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
  {% include 'nav.html' %}
</head>
<body>
  <div class="container mt-5">
    <h2 class="mb-4">Malla Espejo</h2>

    {% if fichaSeleccionada %}
      <div class="alert alert-info d-flex align-items-center justify-content-between">
        <div>
          <strong>Ficha Seleccionada:</strong>
          NÃºmero: {{ fichaSeleccionada[1] }} |
          Programa: {{ fichaSeleccionada[3] }} |
          Jornada: {{ fichaSeleccionada[4] }} |
          Intensidad: {{ fichaSeleccionada[5] }}
        </div>
      </div>
      <input type="hidden" id="fichaSeleccionadaNumero" value="{{ fichaSeleccionada[1] }}">
      <input type="hidden" id="fichaSeleccionadaPrograma" value="{{ fichaSeleccionada[2] }}">
    {% endif %}

    <table class="table table-striped table-hover" id="miTabla">
      <thead>
        <tr>
          <th>id_malla</th>
          <th>Ficha</th>
          <th>Programa</th>
          <th>Jornada</th>
          <th>Horas Trimestre</th>
          <th></th>
        </tr>
      </thead>
      <tbody>
        {% if fichaSeleccionada %}
          {% for malla in mallas %}
            {% set mostrar = false %}
            {# Se filtra por jornada y cant_trimestres, sin mostrar este Ãºltimo #}
            {% if malla[4] == fichaSeleccionada[4] and malla[6] == fichaSeleccionada[6] %}
              {% if malla[5] == 0 and fichaSeleccionada[5] == 330 %}
                {% set mostrar = true %}
              {% elif malla[5] == 1 and fichaSeleccionada[5] == 286 %}
                {% set mostrar = true %}
              {% elif malla[5] == 2 and fichaSeleccionada[5] == 308 %}
                {% set mostrar = true %}
              {% endif %}
            {% endif %}

            {% if mostrar %}
              <tr {% if malla[1] == fichaSeleccionada[1] %} class="highlight" {% endif %}>
                <td>{{ malla[0] }}</td>
                <td>{{ malla[1] }}</td>
                <td>{{ malla[3] }}</td>
                <td>{{ malla[4] }}</td>
                <td>
                  {% if malla[5] == 0 %}
                    330
                  {% elif malla[5] == 1 %}
                    286
                  {% elif malla[5] == 2 %}
                    308
                  {% endif %}
                </td>
                <td>
                  <button 
                    class="btn btn-warning btn-sm" 
                    data-idprog="{{ malla[2] }}"
                    onclick="duplicarFila(this)"
                  >ðŸ“‘</button>
                </td>
              </tr>
            {% endif %}
          {% endfor %}
        {% else %}
          {# Si no se ha seleccionado una ficha, se muestran todas las filas #}
          {% for malla in mallas %}
            <tr>
              <td>{{ malla[0] }}</td>
              <td>{{ malla[1] }}</td>
              <td>{{ malla[3] }}</td>
              <td>{{ malla[4] }}</td>
              <td>
                {% if malla[5] == 0 %}
                  330
                {% elif malla[5] == 1 %}
                  286
                {% elif malla[5] == 2 %}
                  308
                {% endif %}
              </td>
              <td>
                <button 
                  class="btn btn-warning btn-sm" 
                  data-idprog="{{ malla[2] }}"
                  onclick="duplicarFila(this)"
                >ðŸ“‘</button>
              </td>
            </tr>
          {% endfor %}
        {% endif %}
      </tbody>
    </table>
  </div>

  <!-- Bootstrap JS -->
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
  <script src="../static/js/malla_espejo.js"></script>
</body>
</html>
